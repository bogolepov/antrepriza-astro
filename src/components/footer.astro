---
import "@styles/footer.css"

import theater from '@data/theater.json'
import dictionary from '@data/dictionary.json'

import Logo from '../svg/logo.svg?url'

import SocialPages from '@components/social_pages/social_pages.astro'

const {lang} = Astro.props;

import type { ImageMetadata } from 'astro'
import { Picture } from 'astro:assets'
const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/*.{jpeg,jpg,png,gif}');

---
<script>
  import { openFeedbackForm, submitNewsletterForm } from "@scripts/antrepriza.js"
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelector('.feedback-button')?.addEventListener('click', openFeedbackForm);
    document.querySelector('#newsletter-button')?.addEventListener('click', submitNewsletterForm);

    let now = Date.now();
    let nlPh = document.querySelector('#newsletter-phone');
    if(nlPh) { nlPh.value = (now+9).toString(); nlPh.innerText = now.toString(); }
  });
</script>

<footer>
  <div class="footer-flex">
    <div class="footer-flex-item flex2">
      <div class="footer-logo">
        <a href={"/" + lang + "/"}>
          <svg class="footer-logo-svg">
            <!-- <use href={Logo + "#logo"}></use> -->
            <use href={Logo + "#logo-text-" + lang}></use>
            <title>{dictionary.logo[lang]}</title>
          </svg>
        </a>
      </div>
      {
        theater.fix_stages.map(fstg => {
          let stage = theater.stages.find(stg => fstg === stg.sid);
          if (stage) 
            return (
              <div class="address">
                <div class="info-text font-opacity0 bold">{dictionary.stage[lang] + " - " + stage.name[lang].toUpperCase()}</div>
                <div class="info-text font-opacity0">{stage.address.full_string}</div>
              </div>
          );
        })
      }    
      <div class="contact">
        <div class="info-text font-opacity0">
          <a href={"tel:"+theater.phone}><span class="font-opacity1 phone-number">{dictionary.telephone_short[lang]}:</span> {theater.phone}</a>
        </div>
        <div class="info-text font-opacity0">
          <a href={"mailto:"+theater.email}><span class="font-opacity1">{dictionary.email[lang]}:</span> {theater.email}</a>
        </div>
      </div>
    </div>
    <div class="footer-flex-item flex2">
      <div class="newsletter">
        <div class="newsletter-label">{dictionary.newsletter_title[lang]}</div>
        <form method="POST" id="newsletter-form" class="newsletter-form">
          <div class="newsletter-input-container">
            <input id="newsletter-phone" type="hidden" name="phone" value=""/>
            <input type="text" class="newsletter__input" name="email" placeholder={dictionary.email_hint[lang]} autocomplete="on">
            <button id="newsletter-button" class="newsletter__button">&#10153;</button>
            <div class="newsletter-input-loader"></div>
          </div>
          <div class="newsletter-message"></div>
        </form>
      </div>
      <SocialPages lang={lang} />
      <div>
        <button class="feedback-button">{dictionary.question_form_label[lang]}</button>
      </div>
      <div class="lh-1-3">
        <div><a class="footer-text-link" href={"/" + lang + "/impressum"}>{dictionary.impressum[lang]}</a></div>
        <div><a class="footer-text-link" href={"/" + lang + "/privacy-policy"}>{dictionary.privacy_policy[lang]}</a></div>
      </div>
      <div class="copyright-year font-opacity1 lh-1-1">© 2024 {theater.longTheaterName[lang]}</div>
    </div>
    <div class="footer-flex-item flex2">
      <div class="footer-partners">
        <div class="title font-opacity1">{dictionary.partners[lang].toUpperCase()}</div>
        <div class="logo-flex">
          <div class="logo-50 hover-block">
            <a class="black-white-filter" href="https://svoi.berlin/" target="_blank"	rel="noopener external">
              <Picture 
                class:list={'image-wrapper-landscape'} 
                src={images["/src/assets/logo_svoi.png"]()} 
                formats={['webp']} 
                sizes={'50px'}
                widths={[50]}
                alt="Svoi.Berlin" />
              </a>
          </div>
          <div class="logo-50 hover-block">
            <a class="black-white-filter" href="https://www.auswaertiges-amt.de/" target="_blank"	rel="noopener external">
              <Picture 
                class:list={'image-wrapper-landscape'} 
                src={images["/src/assets/logo_auswaertiges_amt.png"]()} 
                formats={['webp']} 
                sizes={'50px'}
                widths={[50]}
                alt="Auswärtiges Amt" />
              </a>
          </div>
          <div class="logo-50 hover-block">
            <a class="black-white-filter" href="https://www.neue-buehne-friedrichshain.de/" target="_blank"	rel="noopener external">
              <Picture 
                class:list={'image-wrapper-landscape'} 
                src={images["/src/assets/logo_nbf.png"]()} 
                formats={['webp']} 
                sizes={'50px'}
                widths={[50]}
                alt="Neue Bühne Friedrichshain" />
              </a>
          </div>
          <div class="logo-75 hover-block">
            <a class="black-white-filter" href="https://www.kontramarka.de" target="_blank"	rel="noopener external">
              <Picture 
                class:list={'image-wrapper-landscape'} 
                src={images["/src/assets/logo_kontramarka.png"]()} 
                formats={['webp']} 
                sizes={'75px'}
                widths={[75]}
                alt="Kontramarka" />
              </a>
          </div>
          <div class="logo-75 hover-block">
            <a class="black-white-filter" href="https://www.quarteera.de/" target="_blank"	rel="noopener external">
              <Picture 
                class:list={'image-wrapper-landscape'} 
                src={images["/src/assets/logo_quarteera.png"]()} 
                formats={['webp']} 
                sizes={'75px'}
                widths={[75]}
                alt="Quarteera" />
              </a>
          </div>
        </div>
      </div>
      <div class="web-developer">
        <div class="label font-opacity1">{dictionary.web_developer[lang]}</div>
        <a class="font-opacity1 bold1" href={theater.web_developer.url} target="_blank"	rel="noopener external">{theater.web_developer.name[lang]}</a> 
      </div>
    </div>
  </div>
</footer>
